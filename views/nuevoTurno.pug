doctype html
html
  head
    title Crear Nuevo Turno
    link(rel='stylesheet', href='/styles.css')
  body
    h1 Crear Nuevo Turno

    form(action='/turnos', method='POST')

      div
        label Paciente:
        select(name='paciente_id' required)
          option(value='') Selecciona un paciente
          each p in pacientes
            option(value=p.id)= p.nombre

      div
        label Especialidad:
        select(name='especialidad_id' id='especialidad_id' required)
          option(value='') Selecciona una especialidad
          each especialidad in especialidades
            option(value=especialidad.id)= especialidad.nombre

      div
        label Profesional:
        select(name='profesional_id' id='profesional_id' required)
          option(value='') Selecciona un profesional

      div
        label Sucursal:
        select(name='sucursal_id' required)
          option(value='') Selecciona una sucursal
          each sucursal in sucursales
            option(value=sucursal.id)= sucursal.nombre

      div
        label Fecha:
        input(type='date', name='fecha', id='fecha', required)

      div
        label Hora:
        select(name='hora', id='hora', required)
          option(value='') Selecciona un horario

      div
        button(type='submit') Crear Turno

    a(href='/turnos') Volver a la lista de turnos


    script.
      document.addEventListener('DOMContentLoaded', () => {

        const especialidad = document.getElementById('especialidad_id');
        const profesional = document.getElementById('profesional_id');
        const fecha = document.getElementById('fecha');
        const hora = document.getElementById('hora');

        especialidad.addEventListener('change', () => {
          fetch(`/profesionales/especialidad/${especialidad.value}`)
            .then(r => r.json())
            .then(data => {
              profesional.innerHTML = '<option value="">Selecciona un profesional</option>';
              data.forEach(p => {
                profesional.innerHTML += `<option value="${p.id}">${p.nombre_completo}</option>`;
              });
            });
        });

        function cargarHorarios() {

          if (!profesional.value || !fecha.value) return;

          fetch(`/turnos/horarios-disponibles/${profesional.value}/${fecha.value}`)
            .then(r => r.json())
            .then(horarios => {

              hora.innerHTML = '<option value="">Selecciona un horario</option>';

              horarios.forEach(h => {
                hora.innerHTML += `<option value="${h}">${h}</option>`;
              });
            });
        }

        profesional.addEventListener('change', cargarHorarios);
        fecha.addEventListener('change', cargarHorarios);

      });
